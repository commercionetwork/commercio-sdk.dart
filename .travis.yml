jobs:
  include:

    ## ----------------------------------------
    ## --- Steps to test and build the code
    ## ----------------------------------------

    - language: dart
      dart_task:
        - test: --platform vm
        - dartftm
        - dartanalyzer: --fatal-warnings lib

    ## ----------------------------------------------------
    ## --- Steps to build and publish the documentation
    ## ----------------------------------------------------

    - language: node_js
      install:
        - npm ci

      script:
        - npm run docs:build
        - echo 'dart.sdk.docs.commercio.network' > docs/.vuepress/dist/CNAME

      deploy:
        provider: pages
        skip_cleanup: true
        local_dir: docs/.vuepress/dist
        github-token: $GITHUB_TOKEN
        keep-history: true
        on:
          tags: true
